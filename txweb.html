<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Game T√†i X·ªâu - ƒêƒÉng nh·∫≠p</title>
  <style>
    body {
      font-family: Arial;
      text-align: center;
      background: #f2f2f2;
      padding: 40px;
    }
    h1 {
      color: #333;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      font-size: 16px;
    }
    .hidden {
      display: none;
    }
    .game-area {
      margin-top: 30px;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
      width: 90%;
      max-width: 600px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    th {
      background: #eee;
    }
  </style>
</head>
<body>
  <h1>Game T√†i X·ªâu</h1>

  <!-- ƒêƒÉng k√Ω / ƒêƒÉng nh·∫≠p -->
  <div id="auth">
    <h3>ƒêƒÉng k√Ω / ƒêƒÉng nh·∫≠p</h3>
    <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" /><br />
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" /><br />
    <button onclick="register()">T·∫°o t√†i kho·∫£n</button>
    <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
    <div id="authMessage"></div>
  </div>

  <!-- Khu v·ª±c ch∆°i game -->
  <div id="game" class="hidden game-area">
    <h2>Xin ch√†o, <span id="displayName"></span>!</h2>
    <div class="balance" id="balance">S·ªë d∆∞: 0</div>

    <select id="betChoice">
      <option value="T√†i">T√†i</option>
      <option value="X·ªâu">X·ªâu</option>
    </select>
    <input type="number" id="betAmount" value="100" min="1" />
    <button onclick="playGame()">L·∫Øc X√≠ Ng·∫ßu</button>

    <div class="dice" id="dice">üé≤üé≤üé≤</div>
    <div id="result">K·∫øt qu·∫£ s·∫Ω hi·ªán ·ªü ƒë√¢y...</div>

    <h3>L·ªãch s·ª≠:</h3>
    <table id="historyTable">
      <tr>
        <th>V√°n</th>
        <th>Ch·ªçn</th>
        <th>T·ªïng</th>
        <th>K·∫øt qu·∫£</th>
        <th>Th·∫Øng/Thua</th>
      </tr>
    </table>
  </div>

  <script>
    let currentUser = null;
    let round = 1;

    function register() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (!user || !pass) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
      }

      const users = JSON.parse(localStorage.getItem("users") || "{}");
      if (users[user]) {
        document.getElementById("authMessage").innerText = "T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!";
        return;
      }

      users[user] = { password: pass, balance: 1000, history: [] };
      localStorage.setItem("users", JSON.stringify(users));
      document.getElementById("authMessage").innerText = "T·∫°o t√†i kho·∫£n th√†nh c√¥ng! ƒêƒÉng nh·∫≠p ƒë·ªÉ ch∆°i.";
    }

    function login() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;

      const users = JSON.parse(localStorage.getItem("users") || "{}");
      if (!users[user] || users[user].password !== pass) {
        document.getElementById("authMessage").innerText = "Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!";
        return;
      }

      currentUser = user;
      document.getElementById("auth").classList.add("hidden");
      document.getElementById("game").classList.remove("hidden");
      document.getElementById("displayName").innerText = currentUser;
      updateBalance();
      loadHistory();
    }

    function updateBalance() {
      const users = JSON.parse(localStorage.getItem("users"));
      const balance = users[currentUser].balance;
      document.getElementById("balance").innerText = "S·ªë d∆∞: " + balance;
    }

    function playGame() {
      const users = JSON.parse(localStorage.getItem("users"));
      const userData = users[currentUser];

      const betChoice = document.getElementById("betChoice").value;
      const betAmount = parseInt(document.getElementById("betAmount").value);

      if (betAmount > userData.balance || betAmount <= 0) {
        alert("S·ªë ti·ªÅn c∆∞·ª£c kh√¥ng h·ª£p l·ªá!");
        return;
      }

      const dice1 = Math.floor(Math.random() * 6) + 1;
      const dice2 = Math.floor(Math.random() * 6) + 1;
      const dice3 = Math.floor(Math.random() * 6) + 1;
      const total = dice1 + dice2 + dice3;
      const emoji = ["‚öÄ", "‚öÅ", "‚öÇ", "‚öÉ", "‚öÑ", "‚öÖ"];

      document.getElementById("dice").innerText =
        emoji[dice1 - 1] + emoji[dice2 - 1] + emoji[dice3 - 1];

      let result = "";
      if (dice1 === dice2 && dice2 === dice3) {
        result = "B·ªô ba";
      } else if (total >= 4 && total <= 10) {
        result = "X·ªâu";
      } else {
        result = "T√†i";
      }

      let win = result === betChoice;
      if (win) {
        userData.balance += betAmount;
      } else {
        userData.balance -= betAmount;
      }

      // L∆∞u l·ªãch s·ª≠
      userData.history.push({
        round: round,
        bet: betChoice,
        total: total,
        result: result,
        change: win ? "+" + betAmount : "-" + betAmount,
      });

      localStorage.setItem("users", JSON.stringify(users));
      updateBalance();
      addHistoryRow(round, betChoice, total, result, win ? "+" + betAmount : "-" + betAmount);
      document.getElementById("result").innerText =
        `T·ªïng: ${total} - ${result} => ${win ? "Th·∫Øng!" : "Thua!"}`;
      round++;
    }

    function loadHistory() {
      const users = JSON.parse(localStorage.getItem("users"));
      const history = users[currentUser].history || [];

      const table = document.getElementById("historyTable");
      // X√≥a l·ªãch s·ª≠ c≈©
      while (table.rows.length > 1) table.deleteRow(1);

      history.forEach(h => {
        addHistoryRow(h.round, h.bet, h.total, h.result, h.change);
        round = h.round + 1;
      });
    }

    function addHistoryRow(r, b, t, rs, ch) {
      const table = document.getElementById("historyTable");
      const row = table.insertRow();
      row.innerHTML = `<td>${r}</td><td>${b}</td><td>${t}</td><td>${rs}</td><td>${ch}</td>`;
    }
  </script>
</body>
</html>
